#!/bin/bash

DIR=$(cd $(dirname $BASH_SOURCE);pwd)

DATA="\
PRODUCER AGENCY               : GFZ
PRODUCER INSTITUTION          : GFZ
FILE TYPE ipAOD1BF            : 999
FILE FORMAT 0=BINARY 1=ASCII  : 1
NUMBER OF HEADER RECORDS      : 29
SOFTWARE VERSION              : atm_ocean_dealise.06
SOFTWARE LINK TIME            : Not Applicable
REFERENCE DOCUMENTATION       : GRACE AOD1B PDD
SATELLITE NAME                : GRACE X
SENSOR NAME                   : Not Applicable
TIME EPOCH (GPS TIME)         : 2000-01-01 12:00:00
TIME FIRST OBS(SEC PAST EPOCH):  439128000.000000 (2013-12-{DAY} 00:00:00)
TIME LAST OBS(SEC PAST EPOCH) :  439203600.000000 (2013-12-{DAY} 21:00:00)
NUMBER OF DATA RECORDS        :   527072
PRODUCT START CREATE TIME(UTC): 2016-09-20 20:34:46
PRODUCT END CREATE TIME(UTC)  : 2016-09-20 20:34:52
FILESIZE (BYTES)              :  21086441
FILENAME                      :   AOD1B_2013-12-{DAY}_X_06.asc
PROCESS LEVEL (1A OR 1B)      : 1B
PRESSURE TYPE (SP OR VI)      : VI
MAXIMUM DEGREE                : 180
COEFFICIENTS ERRORS (YES/NO)  : NO
COEFF. NORMALIZED (YES/NO)    : YES
CONSTANT GM [M^3/S^2]         :  0.39860044180000E+15
CONSTANT A [M]                :  0.63781366000000E+07
CONSTANT FLAT [-]             :  0.29825642000000E+03
CONSTANT OMEGA [RAD/S]        :  0.72921150000000E-04
NUMBER OF DATA SETS           : 32
DATA FORMAT (N,M,C,S)         : (2(I3,x),E15.9,X,E15.9)
END OF HEADER
DATA SET 01:  16471 COEFFICIENTS FOR 2013-12-{DAY} 00:00:00 OF TYPE atm
  0   0 -.100000000E+00 0.400000000E+00
  1   0 0.200000000E+00 -.500000000E+00
  1   1 -.300000000E+00 0.600000000E+00
DATA SET 02:  16471 COEFFICIENTS FOR 2013-12-{DAY} 00:00:00 OF TYPE ocn
  0   0 -.100000000E+01 0.400000000E+01
  1   0 0.200000000E+01 -.500000000E+01
  1   1 -.300000000E+01 0.600000000E+01
DATA SET 03:  16471 COEFFICIENTS FOR 2013-12-{DAY} 00:00:00 OF TYPE glo
  0   0 -.100000000E+02 0.400000000E+02
  1   0 0.200000000E+02 -.500000000E+02
  1   1 -.300000000E+02 0.600000000E+02
DATA SET 04:  16471 COEFFICIENTS FOR 2013-12-{DAY} 00:00:00 OF TYPE oba
  0   0 -.100000000E+03 0.400000000E+03
  1   0 0.200000000E+03 -.500000000E+03
  1   1 -.300000000E+03 0.600000000E+03
DATA SET 05:  16471 COEFFICIENTS FOR 2013-12-{DAY} 03:00:00 OF TYPE atm
  0   0 -.100000000E+00 0.400000000E+00
  1   0 0.200000000E+00 -.500000000E+00
  1   1 -.300000000E+00 0.600000000E+00
DATA SET 06:  16471 COEFFICIENTS FOR 2013-12-{DAY} 03:00:00 OF TYPE ocn
  0   0 -.100000000E+01 0.400000000E+01
  1   0 0.200000000E+01 -.500000000E+01
  1   1 -.300000000E+01 0.600000000E+01
DATA SET 07:  16471 COEFFICIENTS FOR 2013-12-{DAY} 03:00:00 OF TYPE glo
  0   0 -.100000000E+02 0.400000000E+02
  1   0 0.200000000E+02 -.500000000E+02
  1   1 -.300000000E+02 0.600000000E+02
DATA SET 08:  16471 COEFFICIENTS FOR 2013-12-{DAY} 03:00:00 OF TYPE oba
  0   0 -.100000000E+03 0.400000000E+03
  1   0 0.200000000E+03 -.500000000E+03
  1   1 -.300000000E+03 0.600000000E+03
"
for i in $(seq -w 1 10)
do
  echo "$DATA" | sed 's:{DAY}:'$i':g' > /tmp/AOD1B_test${i}_X_06.asc
done

export lmax=1
$DIR/aod-mean.awk /tmp/AOD1B_test*_X_06.asc

cat GA[ABCD]_2013-12-*.gfc

rm -f GA[ABCD]_2013-12-*.gfc /tmp/AOD1B_test*_X_06.asc
